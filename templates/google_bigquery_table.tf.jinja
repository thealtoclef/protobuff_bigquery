resource "google_bigquery_table" "{{ dataset_id }}-{{ table_id }}" {
  deletion_protection = false
  dataset_id          = google_bigquery_dataset.{{ dataset_id }}.dataset_id
  table_id            = "{{ table_id }}"

  labels = {
    "managed-by" = "terraform"
    "corpgroup"  = "cake-data",
    "data_zone"  = "raw_zone",
    "loader"     = "pubsub"
  }

  time_partitioning {
    type  = "DAY"
    field = "{{ partitioning_field }}"
  }

  {% if clustering_fields -%}
  clustering = [{% for field in clustering_fields %}"{{ field }}"{% if not loop.last %}, {% endif %}{% endfor %}]
  {%- endif %}

  schema = <<EOF
{{ schema }}
EOF

}
